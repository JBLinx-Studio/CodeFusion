var l=Object.defineProperty;var d=(s,t,e)=>t in s?l(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var c=(s,t,e)=>d(s,typeof t!="symbol"?t+"":t,e);const r=class r{constructor(){c(this,"accessToken",null);c(this,"tokenExpiry",0)}static getInstance(){return r.instance||(r.instance=new r),r.instance}getConfig(){return localStorage.getItem("paypal_test_mode")==="true"||!1?{clientId:"AfaF0EX_vYoZ5D3-P4RSCZ0FjFwHY3v88MhbcytGX9uTkQdDFrQKKFNDzwNsjdn3wPgSPsqrJsdho7RH",clientSecret:"EJHoNOgMSLIDSnUIVsQ76aCO0xdHP7AMS51X4-SpxtFo8hTdcy-lirfQuAgU3PkMgulWO9y4fqFZMPzF",baseUrl:"https://api-m.sandbox.paypal.com"}:{clientId:"Abrc68jTAU0GltdLz1FYYLMLaD5Y952gRrHtwrzeWI4-C8nlafFLdcH95KXpo3Fc6zYZsdIkiV7Jnl34",clientSecret:"",baseUrl:"https://api-m.paypal.com"}}async getAccessToken(){if(this.accessToken&&Date.now()<this.tokenExpiry)return this.accessToken;const t=this.getConfig(),e=btoa(`${t.clientId}:${t.clientSecret}`);try{const n=await fetch(`${t.baseUrl}/v1/oauth2/token`,{method:"POST",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:"grant_type=client_credentials"});if(!n.ok)throw new Error(`Auth failed: ${n.status}`);const o=await n.json();return this.accessToken=o.access_token,this.tokenExpiry=Date.now()+o.expires_in*1e3-6e4,this.accessToken}catch(n){throw console.error("PayPal auth error:",n),n}}async createProduct(){const t=this.getConfig(),e=await this.getAccessToken(),n={name:"CodeFusion Starter",description:"Essential tools for serious developers - unlimited private projects, custom domains, and email support",type:"SERVICE",category:"SOFTWARE"};try{const o=await fetch(`${t.baseUrl}/v1/catalogs/products`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok)throw new Error(`Product creation failed: ${o.status}`);return await o.json()}catch(o){throw console.error("Product creation error:",o),o}}async createSubscriptionPlan(t){const e=this.getConfig(),n=await this.getAccessToken(),o={product_id:t,name:"Starter Monthly Plan",description:"Monthly subscription for CodeFusion Starter plan",status:"ACTIVE",billing_cycles:[{frequency:{interval_unit:"MONTH",interval_count:1},tenure_type:"REGULAR",sequence:1,total_cycles:0,pricing_scheme:{fixed_price:{value:"5.00",currency_code:"USD"}}}],payment_preferences:{auto_bill_outstanding:!0,setup_fee:{value:"0.00",currency_code:"USD"},setup_fee_failure_action:"CONTINUE",payment_failure_threshold:1}};try{const a=await fetch(`${e.baseUrl}/v1/billing/plans`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Plan creation failed: ${a.status}`);return await a.json()}catch(a){throw console.error("Plan creation error:",a),a}}async createSandboxPlan(){try{console.log("Creating sandbox product...");const t=await this.createProduct();console.log("Creating sandbox plan...");const e=await this.createSubscriptionPlan(t.id);return console.log("Sandbox plan created successfully:",{productId:t.id,planId:e.id}),{productId:t.id,planId:e.id}}catch(t){throw console.error("Sandbox plan creation failed:",t),t}}};c(r,"instance");let i=r;export{i as PayPalAPIService};
